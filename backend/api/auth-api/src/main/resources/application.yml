spring:
  application:
    name: auth-api

  datasource:
    url: ${DATABASE_URL:jdbc:postgresql://localhost:5432/zenless}
    username: ${DATABASE_USERNAME:zenless}
    password: ${DATABASE_PASSWORD:zenless123}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: ${JPA_DDL_AUTO:update}
    show-sql: ${JPA_SHOW_SQL:true}
    properties:
      hibernate:
        format_sql: ${JPA_FORMAT_SQL:true}
        dialect: org.hibernate.dialect.PostgreSQLDialect

server:
  port: ${SERVER_PORT:8081}
  tomcat:
    relaxed-query-chars: '[,],{,},|,\,^,`,<,>,"'
    uri-encoding: UTF-8

jwt:
  # 보안: 기본 시크릿 없음 - 반드시 환경변수로 제공해야 함
  # 개발환경: application-dev.yml 참조
  secret: ${JWT_SECRET:}
  access-token-expiration: ${JWT_ACCESS_EXPIRATION:3600000}    # 1시간 (ms)
  refresh-token-expiration: ${JWT_REFRESH_EXPIRATION:604800000} # 7일 (ms)
  issuer: ${JWT_ISSUER:zenless}

# Rate Limiting 설정
rate-limit:
  auth:
    capacity: ${RATE_LIMIT_AUTH_CAPACITY:10}           # 버킷 최대 용량
    refill-tokens: ${RATE_LIMIT_AUTH_REFILL_TOKENS:10} # 리필 토큰 수
    refill-minutes: ${RATE_LIMIT_AUTH_REFILL_MINUTES:1} # 리필 주기 (분)

# 계정 잠금 설정
security:
  account-lockout:
    enabled: ${ACCOUNT_LOCKOUT_ENABLED:true}
    max-failed-attempts: ${ACCOUNT_LOCKOUT_MAX_ATTEMPTS:5}        # 최대 실패 허용 횟수
    lock-duration-minutes: ${ACCOUNT_LOCKOUT_DURATION_MINUTES:15}  # 잠금 지속 시간 (분)

# Admin API IP 화이트리스트 설정
admin:
  ip-whitelist:
    enabled: ${ADMIN_IP_WHITELIST_ENABLED:false}                   # 개발환경에서는 비활성화
    allowed-ips: ${ADMIN_IP_WHITELIST_ALLOWED_IPS:127.0.0.1,::1}   # 허용된 IP 목록 (쉼표 구분, CIDR 지원)
    path-patterns: /api/v1/admin/**                                # Admin API 경로 패턴

# 세션 관리 설정
session:
  max-sessions-per-user: ${SESSION_MAX_PER_USER:5}                 # 사용자당 최대 동시 세션 수

# CORS 설정
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:5173,http://127.0.0.1:5173}   # 쉼표로 구분된 origin 목록
  allowed-methods: GET,POST,PUT,DELETE,PATCH,OPTIONS
  allowed-headers: Content-Type,Authorization,Accept,Accept-Language,X-Requested-With
  exposed-headers: X-Request-Id,X-Correlation-ID
  allow-credentials: true
  max-age: 3600

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: when_authorized
    prometheus:
      enabled: true
  metrics:
    tags:
      application: ${spring.application.name}
    distribution:
      percentiles-histogram:
        http.server.requests: true
      slo:
        http.server.requests: 50ms,100ms,200ms,500ms,1s
    enable:
      jvm: true
      process: true
      system: true
      http: true
      cache: true
  prometheus:
    metrics:
      export:
        enabled: true

# 국립국어원 표준국어대사전 API
dictionary:
  api-key: ${DICTIONARY_API_KEY:}

# SpringDoc OpenAPI
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    url: /docs/openapi3.yaml
  api-docs:
    enabled: false
